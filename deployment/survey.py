import streamlit as st
import numpy as np
import pickle

st.markdown(
    """
    <style>
        body {
            direction: rtl;
            text-align: right;
        }
        .css-1d391kg { /* Sidebar */
            direction: rtl;
            text-align: right;
            position: fixed;
            right: 0;
            left: auto;
        }
        .css-1kyxreq { /* Main content block */
            direction: rtl;
            text-align: right;
        }
    </style>
    """,
    unsafe_allow_html=True,
)

questions = [
    "😀 أحب أكون محور الانتباه في الحفلات.",
    "💬 ما أتكلم كثير وأميل للسكوت.",
    "🤗 أرتاح إذا كنت حول الناس.",
    "🕶️ أفضل أجلس في الخلفية بعيد عن الانتباه.",
    "💬 دايم أبدأ المحادثات بنفسي.",
    "🤐 ما يكون عندي كلام كثير أحيانًا.",
    "👥 أحب أتكلم مع ناس مختلفين في الحفلات.",
    "🫥 ما أحب ألفت الانتباه لنفسي.",
    "🌟 عادي عندي أكون محور الاهتمام.",
    "🤐 أكون هادئ إذا كنت مع ناس ما أعرفهم.",
    "😰 أتوتر بسرعة في بعض المواقف.",
    "🧘‍♂️ أغلب الوقت أكون مسترخي ورايق.",
    "😟 أقلق كثير على الأمور اللي تهمني.",
    "🙂 نادرًا ما أحس بالكآبة، وأميل للتفاؤل.",
    "😖 أكون حساس تجاه بعض الأمور.",
    "😡 أتوتر وأعصب بسرعة.",
    "🎭 مزاجي يتغير كثير وبسرعة.",
    "🌪️ عندي تقلبات مزاجية متكررة.",
    "😠 أحيانًا أعصب بسرعة.",
    "😔 غالبًا أحس بالكآبة.",
    "😶 ما أهتم كثير بمشاعر الآخرين.",
    "🤗 أحب أهتم بالناس وأساعدهم.",
    "🗣️ أحيانًا أسيء للناس بدون قصد.",
    "🤝 أتعاطف مع مشاعر الآخرين.",
    "🙅‍♂️ ما أهتم بمشاكل الآخرين أحيانًا.",
    "💓 قلبي طيب وأحب أساعد غيري.",
    "🛑 ما أكون مهتم بالناس كل الوقت.",
    "⏳ دايم أخصص وقت للناس اللي أقدرهم.",
    "🫂 أحس بمشاعر الآخرين وأفهمهم.",
    "😌 أحب أريح اللي حولي وأخليهم مرتاحين.",
    "🗂️ دايم أكون مستعد لكل شيء.",
    "📦 أحيانًا أخلي أغراضي مبعثرة.",
    "🔍 أحب أدقق في التفاصيل.",
    "🧹 أحيانًا أفشل أرتب أموري.",
    "🚀 أحب أنجز شغلي بسرعة وبدون تأخير.",
    "🗂️ أنسى أرجع الأشياء مكانها أحيانًا.",
    "📚 أحب النظام وارتب كل شيء.",
    "🛌 أحيانًا أتهرب من بعض المسؤوليات.",
    "📅 دايم ألتزم بجدولي.",
    "🎯 أحب أكون دقيق في شغلي.",
    "📖 عندي مفردات غنية وأحب أتعلم كلمات جديدة.",
    "🧠 أحيانًا يكون صعب علي أفهم الأفكار المجردة.",
    "🌈 عندي خيال واسع وأحب الأفكار الإبداعية.",
    "💭 ما أهتم كثير بالأفكار المجردة.",
    "💡 عندي أفكار رائعة وأحب أشاركها.",
    "🛑 ما أمتلك خيال واسع دائمًا.",
    "⚡ أفهم الأمور بسرعة وأستوعبها بسهولة.",
    "📝 أحب أستخدم كلمات معبرة أحيانًا.",
    "🤔 أحب أفكر وأتأمل في الأشياء اللي تهمني.",
    "🎨 دايم عندي أفكار جديدة وأحب الإبداع."
]


options = [
    "أعترض بقوة",
    "أعترض",
    "محايد",
    "أوافق",
    "أوافق بقوة"
]
# these were inferred from the clusters (anaylized muliple rows)
cluster_descriptions = { 
    0: "يا سلام، شكلك تحب الانفتاح والتعبير عن نفسك، مع لمسة من الحساسية والتفكير الإبداعي. تحب التفاصيل الدقيقة وتتميز بالالتزام، رغم أنك تميل أحيانًا للتوتر. شخصيتك تظهر فيها مزيج من الجرأة والانضباط، مما يجعل منك شخصًا منتجًا في بيئات تعتمد على الإبداع والجهد.\n\n"
       "لو بعطيك نصيحة... حاول توظيف حساسيتك وانفتاحك في مجالات تقدر فيها الابتكار والتنظيم! 🎨📋",
    1: "واضح إنك شخص اجتماعي ومغامر! عندك قدرة على الحفاظ على هدوئك حتى في أصعب الظروف، ومع ذلك تحب تكون في وسط الأحداث وتستمتع باستكشاف أشياء جديدة. شخصيتك تعكس روح المغامرة والانفتاح، والناس دايم يحسون بالطاقة الإيجابية لما يكونون حولك.\n\n"
       "لو بعطيك نصيحة... استفد من قدرتك على التأقلم وجرّب أدوار تتطلب الشجاعة والانفتاح على الآخرين! 🌍🗣️",
    2: "شخصيتك متوازنة وعملية، مع لمسة من الاستقرار العاطفي. تحب تبني أفكار جديدة، وتتصرف بتفكير وهدوء. الناس يثقون فيك لأنك متوازن ومرن. أنت من الأشخاص اللي يحبون بناء العلاقات، لكن بطريقة منظمة ومدروسة.\n\n"
       "لو بعطيك نصيحة... استغل توازنك لتكون قائدًا يعتمد عليه في المواقف المختلفة! 🏗️🤝",
    3: "أنت شخص منظم وعملي جدًا، تحب إنجاز المهام بدقة وتهتم بالتفاصيل. ومع ذلك، تملك جانبًا اجتماعيًا يجعل الناس ينجذبون إليك. الناس يشوفونك كشخص يعتمد عليه، خصوصًا لما يتعلق الأمر بإنجاز المشاريع الصعبة.\n\n"
       "لو بعطيك نصيحة... استخدم طاقتك للقيادة وتنظيم المشاريع! 💼🎯",
    4: "شخصيتك تميل للتفكير والتحليل، مع بعض التردد في الانخراط الاجتماعي. حساسيتك العالية تعكس عمق تفكيرك وحرصك. أحيانًا تميل للتفكير الزايد، لكن هالشي يدل على وعيك وحرصك على اتخاذ القرارات الصح.\n\n"
       "لو بعطيك نصيحة... حاول تفتح نفسك أكثر للناس وكن جريئًا في التعبير عن آرائك! 🧠💬",
    5: "يا سلام! أنت شخص متوازن جدًا. عندك القليل من كل شيء، وهذا يخليك تتأقلم مع أي بيئة بسهولة. تحب تبقي الأمور سلسة وبسيطة. الناس يحبونك لأنك شخص مريح ومتفهم، ودائمًا تلقى نفسك وسط الكل.\n\n"
       "لو بعطيك نصيحة... استغل مرونتك في بناء علاقات قوية ومستمرة! 🤝🌟",
    6: "واضح إنك شخص حساس ومتعاطف، ومع ذلك منظم وموثوق. تعمل بشكل رائع مع الآخرين وتقدر أهمية التعاون. الناس يشوفونك كشخص داعم دايمًا، وتحب تساعد غيرك حتى لو كنت مشغول.\n\n"
       "لو بعطيك نصيحة... حافظ على التوازن بين العمل الجماعي واهتمامك بنفسك! 🌸🛠️",
    7: "شخصيتك غامضة ومختلفة، تميل لعدم الانخراط بسهولة. قد تكون ملاحظًا أو تحب البقاء بعيدًا عن الأضواء. عندك قدرة على فهم الأمور من بعيد، وغالبًا تحلل الوضع قبل ما تتخذ أي خطوة.\n\n"
       "لو بعطيك نصيحة... افتح المجال لاستكشاف ذاتك أكثر، قد تكتشف جوانب مدهشة! 🌌🔍",
    8: "شخصيتك تجمع بين الإبداع والالتزام. تحب التفكير بطرق جديدة وتقدر النظام في الوقت نفسه. يمكن الاعتماد عليك في الابتكار والتطوير. الناس يشوفونك كشخص مبدع ويقدر يخلق أفكار خارج الصندوق.\n\n"
       "لو بعطيك نصيحة... جرّب تحويل أفكارك الإبداعية إلى مشاريع ملموسة! ✨💡"
}


# Initialize session state
if "responses" not in st.session_state:
    st.session_state.responses = []
if "current_question" not in st.session_state:
    st.session_state.current_question = 0

# Sidebar
with st.sidebar:
    st.markdown(
        """
        هذا الاختبار التفاعلي يقيم سمات شخصيتك بناءً على:
        -  Extroversion 
        -  Agreeableness 
        -  Conscientiousness 
        -  Neuroticism 
        -  Openness 
        
        جاوب بصدق علشان تعرف نمط شخصيتك!
        """
    )

current_index = st.session_state.current_question
total_questions = len(questions)

if current_index < total_questions:
    # Progress bar
    st.progress(current_index / total_questions)

    # Current question
    st.subheader(questions[current_index])

    # Display buttons in rows
    for i, option in enumerate(options, start=1):
        if st.button(option, key=f"option_{current_index}_{i}"):
            st.session_state.responses.append(i)  # Save the response
            st.session_state.current_question += 1  # Move to the next question
else:
    st.header("نتائج شخصيتك")
    st.success("🎉 كملت الاختبار!")

    features = np.array(st.session_state.responses).reshape(1, -1)

    try:
        with open('big5_cluster_model.pkl', 'rb') as file:
            model = pickle.load(file)

        prediction = model.predict(features)

        st.write(f"🎉 تمت معالجة إجاباتك بنجاح! 🚀")
        st.write(f"{cluster_descriptions[prediction[0]]}")

    except Exception as e:
        st.error(f"خطأ أثناء تحميل أو استخدام النموذج: {e}")

    if st.button("إعادة الاختبار"):
        st.session_state.responses = []
        st.session_state.current_question = 0


