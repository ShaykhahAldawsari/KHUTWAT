import streamlit as st
import numpy as np
import pickle

st.markdown(
    """
    <style>
        body {
            direction: rtl;
            text-align: right;
        }
        .css-1d391kg { /* Sidebar */
            direction: rtl;
            text-align: right;
            position: fixed;
            right: 0;
            left: auto;
        }
        .css-1kyxreq { /* Main content block */
            direction: rtl;
            text-align: right;
        }
    </style>
    """,
    unsafe_allow_html=True,
)

# Updated list of questions
questions = [
    "๐ ุฃุฑุชุงุญ ููุง ุฃููู ุญูู ุงููุงุณ.",
    "๐ฌ ุฃุจุฏุฃ ุงููุญุงุฏุซุงุช.",
    "๐ฐ ุฃุชูุชุฑ ุจุณูููุฉ.",
    "๐ญ ูุฒุงุฌู ูุชุบูุฑ ูุซูุฑ.",
    "๐ค ุฃุญุณ ุจูุดุงุนุฑ ุบูุฑู ูุฃุชุนุงุทู ูุนูู.",
    "โณ ุฃุฎุตุต ููุช ูููุงุณ.",
    "๐ ุฃุฏูู ูู ุงูุชูุงุตูู.",
    "๐ ุฃูุชุฒู ุจุฌุฏููู.",
    "๐ก ุฃููู ุงูุฃููุฑ ุจุณุฑุนุฉ.",
    "๐งโโ๏ธ ุฃููุฑ ูุฃุชุฃูู ูู ุงูุฃุดูุงุก ูุซูุฑ."
]

options = [
    "ุฃุนุชุฑุถ ุจููุฉ",
    "ุฃุนุชุฑุถ",
    "ูุญุงูุฏ",
    "ุฃูุงูู",
    "ุฃูุงูู ุจููุฉ"
]

# these were inferred from the clusters (anaylized muliple rows)
cluster_descriptions = {
    0: "ูุง ุณูุงูุ ุดููู ุชุญุจ ุงููุฏูุก ูุงูุฑุงุญุฉ ุจุนูุฏ ุนู ุงูุฒุญูุฉ. ุชุญุจ ุชุฑุชุจ ุฃููุฑู ุจุนูุงูุฉ ููู ุดูุก ุนูุฏู ุจููุงูู. ูููู ุชูุถู ููุชู ุชุชุฃูู ุฃู ุชุฑูุฒ ุนูู ุชูุงุตูู ุฏูููุฉ ูุซู ุงูุฑุณู ุฃู ุงููุฑุงุกุฉ. ุฅุฐุง ุฃุญุฏ ูุงู ุนูู ุฅูู ููุธู ูุนูููุ ุฃููุฏ ุจูููู ุตุงุฏู!\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุงุณุชูุชุน ุจููุชู ุงููุงุฏุฆุ ุจุณ ูุง ุชูุณู ุชูุณุฑ ุงูุฑูุชูู ูุชุฌุฑุจ ุดูุก ุฌุฏูุฏ ุจูู ูุชุฑุฉ ููุชุฑุฉ! ๐จ",
    1: "ูุงุถุญ ุฅูู ุดุฎุต ูุงุฏุฆ ูุญุณุงุณ ุชุฌุงู ุงููู ุญูููุ ููู ุจููุณ ุงูููุช ุชุญุจ ุชุณุงุนุฏ ุงููู ููุง ุชูุตุฑ. ูููู ุฃุตุฏูุงุคู ููููู ููู ุงูุดุฎุต ุงููู ูุณูุน ููู ุฏุงุฆููุง. ุชุญุจ ุงูุฃููุงุฑ ุงูุฌุฏูุฏุฉ ููู ุดูุก ุนูุฏู ุจุฎุทุฉ ูุฑุชุจุฉ. ุจุณ ุชุฑุง ูุง ูููุน ุชูุงูุฆ ููุณู ุจุฑุญูุฉ ุฃู ูููู ูุทูู!\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุญุงูู ุชุนุทู ููุณู ุงูุฃููููุฉ ุจูู ูู ูุงูุงูุชูุงู ุจุงููุงุณ. ุฃูุช ุชุณุชุงูู ุงูุฑุงุญุฉ ูุซููู! โ",
    2: "ุฃููุ ูุงุถุญ ุฅูู ุฑูุญ ุงูุฌูุณุฉ! ุชุญุจ ุชุถุญู ูุชููุณ ุงููู ุญูููุ ูุฏุงุฆููุง ูุณุชุนุฏ ูุชุฌุฑุจุฉ ุดูุก ุฌุฏูุฏ. ูููู ูุง ุชุญุจ ุชุฏูู ูู ุงูุชูุงุตููุ ุจุณ ุชุนูุถูุง ุจุดุฎุตูุชู ุงูุงุฌุชูุงุนูุฉ ูุญุจู ููุงุณุชูุดุงู. ุฅุฐุง ูุงููุง ุนูู ูุบุงูุฑุ ูุง ูุฐุจูุง!\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ูุง ุชูุณู ุชุฎุทุท ุดูู ููุบุงูุฑุงุชูุ ุนูุดุงู ูู ุดูุก ูููู ููุชุน ุจุฏูู ุชูุชุฑ! ๐บ๏ธ",
    3: "ุฃูุช ุดุฎุต ุญุณุงุณ ูุญุจูุจุ ูุงููุงุณ ุญููู ูุญุจูู ูุทูู. ุจููุณ ุงูููุช ุชุญุจ ุงููุธุงู ููุง ุชุฎุทู ุฎุทูุฉ ุฅูุง ูุฃูุช ูุชุฃูุฏ ูููุง. ูููู ุนูุฏู ุดููุฉ ุงููุชุงุญ ุนูู ุงูุฃููุงุฑ ุงูุฌุฏูุฏุฉุ ุจุณ ูุง ุชุชุฑู ุฑุงุญุชู ูุฃู ุดูุก. ุชุญุจ ูู ุดูุก ูููู ูุฑุชุจ ููุฑูุญ ูุนููู ูููุจู.\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุญุงูู ุชููู ุฃูุซุฑ ุฌุฑุฃุฉ ูุชุฌุฑุจ ุฃุดูุงุก ุฌุฏูุฏุฉุ ูููู ุชูุชุดู ุดุบู ุฌุฏูุฏ! ๐",
    4: "ูุงุงุงูุ ุฃูุช ููู ุงูุงุฌุชูุงุนุงุช ูุงูุฌูุณุงุช. ุชุญุจ ุชุฌูุน ุงููุงุณ ุญููู ูุชููู ูุฑูุฒ ุงูุงูุชูุงูุ ููุน ุฐูู ุซุงุจุช ูููุฒูู ุนุงุทูููุง. ุชุญุจ ุชุณุชูุดู ุงูุฃูุงูู ุงูุฌุฏูุฏุฉ ูุชุชุนูู ุนู ูู ุดูุกุ ููุนุฑูู ุนูู ุฅูู ููุธู ููุญุจูุจ. ูู ููุช ูุฏูุฑุ ุฃููุฏ ูุฑููู ุจูุนุดูู!\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุญุงูุธ ุนูู ุชูุงุฒููุ ูุฎุฐ ููุชู ููุงุณุชุฑุฎุงุก ุจุนูุฏ ุนู ุงูุฃุถูุงุก ุฃุญูุงููุง! ๐โโ๏ธ",
    5: "ุฃูุช ุดุฎุต ูุฑุญ ูุญุจูุจุ ุญูุงุชู ูููุงูุฉ ุถุญู ูููุงูู ููุชุนุฉ. ูููู ูุง ุชุญุจ ุงูุงูุชุฒุงู ุงูุชุงู ุจุงููุธุงูุ ุจุณ ุชุนูุถูุง ุจุทุงูุชู ุงูุฅูุฌุงุจูุฉ ูุญุจู ููุชุฌุงุฑุจ ุงูุฌุฏูุฏุฉ. ุงููุงุณ ูุญุจูู ูููููู ูุนู ูุฃูู ุฏุงูู ุชุถูู ุฌู ููุชุน ูููุงูู.\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุญุงูู ุชุถูู ุดููุฉ ุชูุธูู ูููููุ ุนูุดุงู ุชุณุชูุชุน ุฃูุซุฑ ููุง ุชุถูุน ููุชู! ๐",
    6: "ุดุฎุตูุชู ูุงุฏูุฉ ูููุทููุฉ ุดููุ ููููู ุชุญุจ ุชูุถู ููุชู ุจุฑูุญู ุจุนูุฏ ุนู ุงูุฒุญูุฉ. ุนูุฏู ุดุบู ุชุฌุงู ุงูุฃุดูุงุก ุงููู ุชุญุจูุงุ ูุบุงูุจูุง ุชููู ููุชู ุจุงูุชูุงุตูู ุงูุฏูููุฉ. ูููู ุงููุงุณ ูุดููููู ูุจุงุดุฑ ููุง ุชุญุจ ุงููู ูุงูุฏูุฑุงูุ ููุฐุง ุดู ุฌููู!\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุงูุชุญ ุงูุจุงุจ ุดูู ูููุงุณุ ูููู ุชูุชุดู ุตุฏุงูุงุช ููุชุนุฉ ูุง ููุช ุชุชููุนูุง! ๐ค",
    7: "ูุงุงุงูุ ูุงุถุญ ุฅูู ุดุฎุต ุงุฌุชูุงุนู ูุชุญุจ ุชุชูุงุตู ูุน ุงููุงุณ. ุนูุฏู ุฌุงูุจ ุญุณุงุณ ุจุณ ุจููุณ ุงูููุช ูุชููู ููุญุจูุจ. ุงููุงุณ ูุซููู ููู ููุญุจูู ูุณุชุดูุฑููู ูุฃูู ุชุนุฑู ููู ุชุชุนุงูู ูุน ุงูููุงูู. ุดููู ุชููู ููุฃููุงุฑ ุงูุฌุฏูุฏุฉ ูุชุญุจ ุชุณุงุนุฏ ุงููู.\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ุฎุฐ ููุช ูููุณู ุจุนูุฏ ุนู ุงููุณุงุนุฏุฉุ ูุฃูู ุชุณุชุงูู ุชูุชู ุจููุณู ุฒู ูุง ุชูุชู ุจุงูุขุฎุฑูู! ๐ธ",
    8: "ุดุฎุตูุชู ุชุฌูุน ูู ุดูุก ุฌููู! ุงุฌุชูุงุนู ุฌุฏูุงุ ุญุณุงุณุ ููุชุนุงูู. ุชุญุจ ุงููุธุงู ููู ุดูุก ุนูุฏู ุจููุงููุ ููุน ุฐูู ูุง ุชุชุฑู ูุฑุตุฉ ูุงูุชุดุงู ุฃููุงุฑ ุฌุฏูุฏุฉ ูุชุฌุงุฑุจ ููุชุนุฉ. ุฅุฐุง ูุงููุง ุนูู ุฅูู ูุงุฆุฏ ุจุงููุทุฑุฉุ ุตุฏููู!\n\n"
       " ูู ุจุนุทูู ูุตูุญุฉ...  ูุง ุชูุณู ุชูุงุฒู ุจูู ุดุบูู ูุญุจู ููููุงุฏุฉุ ูุฎุฐ ููุช ุชุณุชูุชุน ููู ุจููุณู! ๐๏ธ"
}




if "responses" not in st.session_state:
    st.session_state.responses = []
if "current_question" not in st.session_state:
    st.session_state.current_question = 0

# Sidebar
with st.sidebar:
     st.markdown(
        """
        ูุฐุง ุงูุงุฎุชุจุงุฑ ุงูุชูุงุนูู ูููู ุณูุงุช ุดุฎุตูุชู ุจูุงุกู ุนูู ุงููููุฐุฌ:
        -  Extroversion 
        -  Agreeableness 
        -  Conscientiousness 
        -  Neuroticism 
        -  Openness 
        
        ุฌุงูุจ ุจุตุฏู ุนูุดุงู ุชุนุฑู ููุท ุดุฎุตูุชู!
        """
    )

current_index = st.session_state.current_question
total_questions = len(questions)

if current_index < total_questions:
    # Progress bar
    st.progress(current_index / total_questions)

    # Current question
    st.subheader(questions[current_index])

    # Display buttons in rows
    for i, option in enumerate(options, start=1):
        if st.button(option, key=f"option_{current_index}_{i}"):
            st.session_state.responses.append(i)  # Save the response
            st.session_state.current_question += 1  # Move to the next question
else:
    st.header("ูุชุงุฆุฌ ุดุฎุตูุชู")
    st.success(" ูููุช ุงูุฃุฎุชุจุงุฑ ๐!")

    features = np.array(st.session_state.responses).reshape(1, -1)

    try:
        with open('mini_big5_cluster_model_scaler.pkl', 'rb') as file:
            scaler = pickle.load(file)
        with open('mini_big5_cluster_model.pkl', 'rb') as file:
            model = pickle.load(file)

        features_scaled = scaler.transform(features)
        prediction = model.predict(features_scaled)

        st.write(" ุชูุช ูุนุงูุฌุฉ ุฅุฌุงุจุงุชู ุจูุฌุงุญ! ๐")
        st.write(f" {cluster_descriptions[prediction[0]]} ")

    except Exception as e:
        st.error(f"ุฎุทุฃ ุฃุซูุงุก ุชุญููู ุฃู ุงุณุชุฎุฏุงู ุงููููุฐุฌ: {e}")

    if st.button("ุฅุนุงุฏุฉ ุงูุงุฎุชุจุงุฑ"):
        st.session_state.responses = []
        st.session_state.current_question = 0
